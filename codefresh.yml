version: '1.0'
mode: parallel
steps:
  build_alpine: &build_alpine
    type: build
    title: Build Alpine image
    dockerfile: Dockerfile-alpine
    image_name: ${{CF_REPO_OWNER}}/${{CF_REPO_NAME}}
    tag: ${{CF_BRANCH}}
    build_arguments:
    - ARCH=amd64
    - OS=linux
    - UPX_VERSION=3.95
    - GHR_VERSION=0.12.0
    when:
      steps:
      - name: main_clone
        on:
        - success

  push_alpine: &push_alpine
    type: push
    title: Push Alpine image
    candidate: ${{build_alpine}}
    image_name: ${{CF_REPO_OWNER}}/${{CF_REPO_NAME}}
    tag: alpine_upx-3_ghr-0.12
    when:
      branch:
        only:
        - /master/
      steps:
      - name: build_alpine
        on:
        - success
